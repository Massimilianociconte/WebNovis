!function(){"use strict";var e=null,t=null,n=!1,r=-1,s=null,i=null,a={},l={};function o(){return a.wrapper?a:a={wrapper:document.getElementById("searchWrapper"),bar:document.getElementById("searchBar"),input:document.getElementById("searchInput"),results:document.getElementById("searchResults"),clear:document.getElementById("searchClear"),overlay:document.getElementById("searchOverlay"),mobileBtn:document.getElementById("searchMobileToggle")}}function c(){return l.modal?l:l={modal:document.getElementById("searchModal"),bar:document.getElementById("searchBarMobile"),input:document.getElementById("searchInputMobile"),results:document.getElementById("searchResultsMobile"),clear:document.getElementById("searchClearMobile"),closeBtn:document.getElementById("searchModalClose"),overlay:document.getElementById("searchOverlay"),mobileBtn:document.getElementById("searchMobileToggle")}}function u(e){if(!e)return"";var t=document.createElement("div");return t.textContent=e,t.innerHTML}function d(e,t){if(!e||!t)return u(e||"");var n=u(e),r=t.trim().split(/\s+/).filter(function(e){return e.length>1});if(!r.length)return n;var s=r.map(function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}).join("|");return n.replace(new RegExp("("+s+")","gi"),"<mark>$1</mark>")}var h={page:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"/><path d="M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>',servizio:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>',articolo:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18h-5"/><path d="M18 14h-8"/><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-4 0v-9a2 2 0 0 1 2-2h2"/><rect width="8" height="4" x="10" y="6" rx="1"/></svg>',portfolio:'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 2h10"/><path d="M5 6h14"/><rect width="18" height="12" x="3" y="10" rx="2"/></svg>'},v={page:"Pagina",servizio:"Servizio",articolo:"Blog",portfolio:"Portfolio"};function p(){return t?Promise.resolve(t):Promise.all([(r="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0/dist/fuse.min.js",new Promise(function(e,t){if(window.Fuse)e();else{var n=document.createElement("script");n.src=r,n.onload=e,n.onerror=function(){t(new Error("Script load failed: "+r))},document.head.appendChild(n)}})),e?Promise.resolve(e):fetch("/search-index.json").then(function(e){if(!e.ok)throw new Error("Index fetch failed");return e.json()}).then(function(t){return e=t,t})]).then(function(){return t=new window.Fuse(e,{keys:[{name:"title",weight:.35},{name:"description",weight:.25},{name:"keywords",weight:.15},{name:"headings",weight:.15},{name:"content",weight:.1}],threshold:.35,distance:200,includeScore:!0,includeMatches:!0,minMatchCharLength:2,ignoreLocation:!0}),n=!0,t});var r}function f(e){return p().then(function(){return t.search(e).slice(0,8).map(function(e){var t=Object.assign({},e.item);return t.score=e.score,t.source="local",t})}).catch(function(){return[]})}function g(e){return i&&i.abort(),i=new AbortController,fetch("/api/search-ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,currentPage:window.location.pathname}),signal:i.signal}).then(function(e){return e.ok?e.json():null}).catch(function(){return null})}function m(e,t,n,r,s,i){if(e){var a,l="";n.length&&(l+='<div class="search-results-section">',l+='<div class="search-results-label">Risultati</div>',n.forEach(function(e,t){l+='<a href="'+u(e.url)+'" class="search-result-item'+(t===i?" selected":"")+'" role="option" data-index="'+t+'" aria-selected="'+(t===i)+'"><span class="search-result-icon">'+(h[e.type]||'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>')+'</span><div class="search-result-content"><div class="search-result-title">'+d(e.title,s)+'</div><div class="search-result-desc">'+d(e.description,s)+'</div></div><span class="search-result-type">'+u(v[e.type]||"Pagina")+"</span></a>"}),l+="</div>"),r&&r.answer&&(l+='<div class="search-results-section search-ai-section">',l+='<div class="search-results-label"><span class="search-ai-badge">AI</span> Risposta intelligente</div>',l+='<div class="search-ai-answer">'+((a=r.answer)?u(a).replace(/\[([^\]]+)\]\((\/[^)]+)\)/g,'<a href="$2" class="search-ai-link">$1</a>'):"")+"</div>",r.suggestedPages&&r.suggestedPages.length&&r.suggestedPages.forEach(function(e){l+='<a href="'+u(e.url)+'" class="search-result-item search-ai-suggestion"><span class="search-result-icon"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z"/><path d="M20 2v4"/><path d="M22 4h-4"/><circle cx="4" cy="20" r="2"/></svg></span><div class="search-result-content"><div class="search-result-title">'+u(e.title)+'</div></div><span class="search-result-relevance">'+Math.round(100*(e.relevance||0))+"%</span></a>"}),r.relatedQueries&&r.relatedQueries.length&&(l+='<div class="search-related">',r.relatedQueries.forEach(function(e){l+='<button class="search-related-tag" data-query="'+u(e)+'">'+u(e)+"</button>"}),l+="</div>"),l+="</div>"),n.length||r||(l+='<div class="search-no-results"><div class="search-no-results-icon"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="m13.5 8.5-5 5"/><path d="m8.5 8.5 5 5"/><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg></div><div class="search-no-results-text">Nessun risultato per "<strong>'+u(s)+'</strong>"</div><div class="search-no-results-hint">Prova con termini diversi o <a href="/contatti.html">contattaci</a></div></div>'),e.innerHTML=l+='<div class="search-footer"><span><kbd>↑↓</kbd> Naviga</span><span><kbd>↵</kbd> Apri</span><span><kbd>Esc</kbd> Chiudi</span></div>',e.classList.add("visible"),e.querySelectorAll(".search-related-tag").forEach(function(n){n.addEventListener("click",function(){t&&(t.value=n.dataset.query),L(e,t,n.dataset.query)})})}}function w(e,t,n){var s=o();m(s.results,s.input,e,t,n,r)}function y(e){if(e&&!e.querySelector(".search-ai-section")){var t=document.createElement("div");t.className="search-ai-loading",t.innerHTML='<span class="search-ai-loading-dot"></span><span class="search-ai-loading-dot"></span><span class="search-ai-loading-dot"></span><span class="search-ai-loading-text">Ricerca AI...</span>';var n=e.querySelector(".search-footer");n?e.insertBefore(t,n):e.appendChild(t)}}function b(e){e&&(e.innerHTML='<div class="search-loading"><div class="search-loading-shimmer"></div><div class="search-loading-shimmer"></div><div class="search-loading-shimmer"></div></div>',e.classList.add("visible"))}function k(e){e&&e.classList.remove("visible")}function E(){k(o().results),r=-1}function L(e,t,r){if(!r||r.length<2)k(e);else{n||b(e);var s=r;f(r).then(function(n){t&&t.value.trim()===s&&(m(e,t,n,null,r,-1),(r.trim().split(/\s+/).length>=4||0===n.length)&&(y(e),g(r).then(function(i){t&&t.value.trim()===s&&i&&m(e,t,n,i,r,-1)})))})}}function B(e){var t=o();if(!e||e.length<2)return E(),void(t.clear&&t.clear.classList.remove("visible"));t.clear&&t.clear.classList.add("visible"),n||b(o().results);var s=e;f(e).then(function(n){t.input.value.trim()===s&&(r=-1,w(n,null,e),(e.trim().split(/\s+/).length>=4||0===n.length)&&(y(o().results),g(e).then(function(r){t.input.value.trim()===s&&r&&w(n,r,e)})))})}var M,x=(M=B,function(){var e=arguments,t=this;clearTimeout(s),s=setTimeout(function(){M.apply(t,e)},150)});function I(e){var t=o();if(t.results&&t.results.classList.contains("visible")){var n=t.results.querySelectorAll(".search-result-item");if(n.length)if("ArrowDown"===e.key)e.preventDefault(),r=Math.min(r+1,n.length-1),A(n);else if("ArrowUp"===e.key)e.preventDefault(),r=Math.max(r-1,-1),A(n);else if("Enter"===e.key&&r>=0){e.preventDefault();var s=n[r];s&&s.href&&(window.location.href=s.href)}else"Escape"===e.key&&(E(),t.input.blur(),D())}}function A(e){e.forEach(function(e,t){e.classList.toggle("selected",t===r),e.setAttribute("aria-selected",String(t===r))}),r>=0&&e[r]&&e[r].scrollIntoView({block:"nearest"})}var C=-1,j=null;function P(){var e=c();e.modal&&(e.modal.classList.add("open"),e.overlay&&e.overlay.classList.add("visible"),e.mobileBtn&&e.mobileBtn.classList.add("active"),document.body.style.overflow="hidden",setTimeout(function(){e.input&&(e.input.focus(),e.input.setAttribute("aria-expanded","true"))},80))}function S(){var e=c();e.modal&&(e.modal.classList.remove("open"),e.overlay&&e.overlay.classList.remove("visible"),e.mobileBtn&&e.mobileBtn.classList.remove("active"),document.body.style.overflow="",e.input&&(e.input.value="",e.input.setAttribute("aria-expanded","false")),e.clear&&e.clear.classList.remove("visible"),e.bar&&e.bar.classList.remove("focused"),k(e.results),C=-1)}function D(){S()}function T(){var e=o();if(e.input){e.input.addEventListener("input",function(e){x(e.target.value.trim())}),e.input.addEventListener("keydown",I),e.input.addEventListener("focus",function(){e.bar.classList.add("focused"),e.input.value.length>=2&&B(e.input.value.trim())}),document.addEventListener("click",function(t){!e.wrapper||e.wrapper.contains(t.target)||e.mobileBtn&&e.mobileBtn.contains(t.target)||(E(),e.bar.classList.remove("focused"))}),e.clear&&e.clear.addEventListener("click",function(){e.input.value="",e.clear.classList.remove("visible"),E(),e.input.focus()}),e.overlay&&window.innerWidth>768&&e.overlay.addEventListener("click",D),document.addEventListener("keydown",function(t){(t.ctrlKey||t.metaKey)&&"k"===t.key&&(t.preventDefault(),window.innerWidth<=768?P():e.input.focus())});var t=!1;document.addEventListener("mouseover",n,{once:!0}),document.addEventListener("touchstart",n,{once:!0}),function(){var e=c();if(e.modal){var t=function(e){return function(){var t=arguments,n=this;clearTimeout(j),j=setTimeout(function(){e.apply(n,t)},150)}}(function(t){L(e.results,e.input,t),e.clear&&e.clear.classList.toggle("visible",t.length>0)});e.input&&(e.input.addEventListener("input",function(){var n=e.input.value.trim();t(n),e.bar&&e.bar.classList.add("focused")}),e.input.addEventListener("focus",function(){e.bar&&e.bar.classList.add("focused");var t=e.input.value.trim();t.length>=2&&L(e.results,e.input,t)}),e.input.addEventListener("blur",function(){e.bar&&e.bar.classList.remove("focused")}),e.input.addEventListener("keydown",function(t){if("Escape"===t.key)t.preventDefault(),S();else if("Enter"===t.key){var n=e.results?e.results.querySelectorAll(".search-result-item"):[];C>=0&&n[C]&&n[C].href&&(t.preventDefault(),window.location.href=n[C].href)}else if("ArrowDown"===t.key||"ArrowUp"===t.key){t.preventDefault();var r=e.results?e.results.querySelectorAll(".search-result-item"):[];if(!r.length)return;C="ArrowDown"===t.key?Math.min(C+1,r.length-1):Math.max(C-1,-1),r.forEach(function(e,t){e.classList.toggle("selected",t===C),e.setAttribute("aria-selected",String(t===C))}),C>=0&&r[C]&&r[C].scrollIntoView({block:"nearest"})}})),e.clear&&e.clear.addEventListener("click",function(){e.input&&(e.input.value="",e.input.focus()),e.clear.classList.remove("visible"),k(e.results),C=-1}),e.closeBtn&&e.closeBtn.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),S()}),e.overlay&&e.overlay.addEventListener("click",S),e.mobileBtn&&e.mobileBtn.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),P()})}}()}function n(){t||(t=!0,p().catch(function(){}))}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",T):T()}();